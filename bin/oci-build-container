#!/bin/bash

findFlavor()
{
    find ./containers -name "Containerfile.${1}"
}

fileFlavor()
{
    local file="${1}"
    echo -n "${file}" | cut -d. -f3
}

containerType()
{
    echo -n "$(basename $(dirname "${1}"))"
}

buildFlavor()
{
    local container="${1}"
    local flavor="$(fileFlavor "${container}")"
    local type="$(containerType "${container}")"
    ./bin/oci-exec build -f "${container}" --tag=${flavor}_notify_${type}:latest --tag=${flavor}_notify_${type}:$(date +"%Y%m%d%H%M%S")
}

: ${FLAVOR="fedora"}

for container in $(findFlavor "${FLAVOR}"); do
    echo "Building container: ${container}"
    buildFlavor ${container}
done
